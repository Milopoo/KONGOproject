<!DOCTYPE html>
<html lang="es">

</html>
<html>

<head>
    <title>FACTURAS</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shorcut icon" type="image/x-icon" href="./img/Logo_Empresa-modified.ico">
    <link rel="stylesheet" href="estilos/estilos.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
    <div class="social-logo">
        <img class="logo-factura" src="img/Logo_Empresa-modified.png">
    </div>
    <h2 class="info-contacto"><i class="fa fa-align-left" aria-hidden="true"></i> Facturas</h2>

    <h1 class="title-fact">Aqui se muestran todas las facturas generadas</h1>


    <!--<p>Presione el botón para desplegar todas las facturas</p>-->

    <!--<button onclick="showContent()">Show hidden content</button>-->

    <div id="fact">



    </div>


    <!--<template id="productrow">
            <tr>
                <td class="record"></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </template>
    -->

    <!--<select name="estados" id="estados">
        <option value="pendiente">Factura pendiente</option>
        <option value="pagada">Factura pagada</option>
        <option value="enviado">Pedido enviado</option>
        <option value="entregado">Pedido entregado</option>
    </select>-->


    <script type="module" src="firebaseFact.js"> </script>
    <script type="module">
        import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";

        const database = getDatabase();
        const fact = document.getElementById('fact')

        var id = '';
        const querySnapshot = await get(ref(database, 'Facturas'));
        fact.innerHTML = ''
        const dbRef = ref(database);
        get(child(dbRef, 'Facturas')).then((snapshot) => {
            if (snapshot.exists()) {
                querySnapshot.forEach(database => {
                    console.log(database.val());
                    fact.innerHTML += ` 
                    <table id="producttable">
        <thead>
            <tr>
                <td>FACTURAS GENERADAS</td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <table id="producttable"56>
        <tr>
          <th>#FACTURA</th>
          <th>CLIENTE</th>
          <th>TELÉFONO</th>
          <th>MÉTODO DE ENVIO</th>
          <th>FECHA DE COMPRA</th>
          <th>MÉTODO DE PAGO</th>
          <th>ESTADO PEDIDO</th>
          <th>TOTAL DE COMPRA</th>
        </tr>
        <tr>
          <td>${database.val().IdFactura}</td>
          <td>${database.val().Nombre}</td>
          <td>${database.val().Tel}</td>
          <td>${database.val().Envio}</td>
          <td>${database.val().FechaCompra}</td>
          <td>${database.val().Metodo}</td>
          <td>${database.val().Estado}</td>
          <td>${"$ " + database.val().Total}</td>
        </tr>
        <table id="producttable">
            <thead>
                <tr>
                    <td>
                        <button class="verFact" data-id="${database.val().IdFactura}">
                            ver factura
                        </button>
                    </td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
      </table>`
                    //console.log(database.val().IdFactura);
                });
            } else {
                console.log("No hay datos asi")
            }
            const verFact = document.querySelectorAll('.verFact')
            verFact.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    //console.log("id", e.target.dataset.id)
                    id = e.target.dataset.id;
                    actualizarEsta(e.target.dataset.id);
                })
            })
        }).catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;
            console.log(error.code + error.message)
        })
        //Mostrar factura
        async function actualizarEsta(id) {
            const docRef = ref(database, "Facturas");
            const docSnap = await get(child(docRef, id));
            //console.log("id", id);

            if (docSnap.exists()) {
                console.log("Lo que sea ")
                //window.location.href = "editarYeliminar.html" + '?id=' + id;
                return false;

            } else {
                // doc.data() will be undefined in this case
                console.log("No such document!");
            }
        }

    </script>

</body>

</html>