<!DOCTYPE html>
<html lang="es">

</html>
<html>

<head>
    <title>FACTURAS</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shorcut icon" type="image/x-icon" href="./img/Logo_Empresa-modified.ico">
    <link rel="stylesheet" href="estilos/estilos.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
    <div class="social-logo">
        <img class="logo-factura" src="img/Logo_Empresa-modified.png">
    </div>
    <h2 class="info-contacto"><i class="fa fa-align-left" aria-hidden="true"></i> Facturas</h2>

    <h1 class="title-fact">Aqui se muestran todas las facturas generadas</h1>


    <!--<p>Presione el botón para desplegar todas las facturas</p>-->

    <!--<button onclick="showContent()">Show hidden content</button>-->
    <table id="producttable">
        <thead>
            <tr>
                <td>FACTURAS GENERADAS</td>
            </tr>
        </thead>
        <tbody>
            <!-- datos opcionales pueden incluirse aquí opcionalmente -->
        </tbody>
    </table>

    <template id="productrow">
        <tr>
            <td class="record"></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>
                <button>
                    ver factura
                </button>
            </td>
        </tr>
  
    </template>

    <!--<select name="estados" id="estados">
        <option value="pendiente">Factura pendiente</option>
        <option value="pagada">Factura pagada</option>
        <option value="enviado">Pedido enviado</option>
        <option value="entregado">Pedido entregado</option>
    </select>-->


    <script type="module" src="firebaseFact.js"> </script>
    <script type="module">
        import { getDatabase, ref, child, get } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-database.js";

        const database = getDatabase();
        var id = '';

        const querySnapshot = await get(ref(database, 'Facturas'));

        const dbRef = ref(database);
        get(child(dbRef, 'Facturas')).then((snapshot) => {
            if (snapshot.exists()) {
                querySnapshot.forEach(database => {
                    console.log(database.val());
                    //console.log(database.val().IdFactura);
                    if ('content' in document.createElement('template')) {

                        // Instanciar la tabla con el tbody existente
                        // y la fila con el template
                        var t = document.querySelector('#productrow'),
                        td = t.content.querySelectorAll("td");
                        td[0].textContent = "#FACTURA";
                        td[1].textContent = "CLIENTE";
                        td[2].textContent = "TELÉFONO";
                        td[3].textContent = "MÉTODO DE ENVIO";
                        td[4].textContent = "FECHA DE COMPRA";
                        td[5].textContent = "MÉTODO DE PAGO";
                        td[6].textContent = "ESTADO PEDIDO";
                        td[7].textContent = "TOTAL DE COMPRA";


                        // Clonar la nueva fila e insertarla en la tabla
                        var tb = document.querySelector("tbody");
                        var clone = document.importNode(t.content, true);
                        tb.appendChild(clone);

                        // Crear una nueva fila
                        td[0].textContent = database.val().IdFactura;
                        td[1].textContent = database.val().Nombre;
                        td[2].textContent = database.val().Tel;
                        td[3].textContent = database.val().Envio;
                        td[4].textContent = database.val().FechaCompra;
                        td[5].textContent = database.val().Metodo;
                        td[6].textContent = database.val().Estado;
                        td[7].textContent = "$ " +  database.val().Total;
                        
                        // Clonar la nueva fila e insertarla en la tabla
                        var clone2 = document.importNode(t.content, true);
                        tb.appendChild(clone2);

                    } 
                });
            } else {
                console.log("No hay datos asi")
            }
        })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                console.log(error.code + error.message)
            })

    </script>

</body>

</html>